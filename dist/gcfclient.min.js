/*!
 * grapesjs-components-farmer client-side script
 * grapesjs plugin to build components for different css framework
 * 
 * @version v0.2.10
 * @author friends@niiknow.org
 * @homepage https://niiknow.github.io/grapesjs-components-farmer/
 * @repository https://github.com/niiknow/grapesjs-components-farmer.git
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("GcfClient",[],t):"object"==typeof exports?exports.GcfClient=t():e.GcfClient=t()}(window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t),function(e){const r="object"==typeof self&&self.self===self&&self||"object"==typeof e&&e.global===e&&e||void 0;t.default=class{constructor(e={}){this._name="GcfClient",this.win=e.win||r,this.opts=e,this.dom=this.win.jQuery,this.ajax=this.dom.ajax,this.doc=this.win.document||{},this.errs={stripe_client:null,stripe_server:null},this.model={},this.init()}decode(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return e}}encode(e){try{return encodeURIComponent(e)}catch(t){return e}}validateAll(e,t){return!0}validatePhone(e,t){return!0}validateEmployment(e,t){return!0}preventNonNumericInput(e){var t=(e=e||this.win.event).which?e.which:e.keyCode;return!(t>31&&(t<48||t>57)&&42!==t&&(e.preventDefault(),1))}stripeResponseHandler(e){if(e.error)return this.isSubmitting=!1,this.errs.stripe_server=e.error.message,!1;const t=e.source,r={};return e.source&&(r.card_brand=t.card.brand,r.card_last4=t.card.last4,r.card_month=t.card_month,r.card_year=t.card_year,r.pay_token=t.id,r.pay_source=JSON.stringify(t)),this.errs.server=null,r}queryParseString(e){e=(e||"").replace("?","").replace("#","");const t=/(\w+)\[(\d+)\]/,r=this.decode,n={};return e.split("&").forEach(e=>{const o=e.split("="),i=r(o[0]),s=t.exec(i);if(s)return n[s[1]]=n[s[1]]||[],void(n[s[1]][s[2]]=r(o[1]));n[o[0]]=r(o[1]||"")}),n||{}}doFormSubmit(e,t){const r=this;r.ajax({type:"POST",mode:"cors",url:e.attr("action"),data:t}).done((e,t,n)=>{r.onDone&&r.onDone(e,t,n)}).fail((e,t,n)=>{r.onFail&&r.onDone(e,t,n)}).always(()=>{setTimeout(()=>{r.isSubmitting=!1},200)})}initStripe(e){const t=this,r=t.opts,n=t.win.Stripe,o=r.stripeStyle,i=r.stripeSelector||"#stripeElement";if("function"==typeof n){const e=(dom(`#${i}`).data("key")||"").trim();e.length>2&&(t.stripe=n(e),t.elements=t.stripe.elements(),t.card=t.elements.create("card",{style:o,hidePostalCode:r.hidePostalCode||!0}),t.card.mount(`#${i}`),t.card.addEventListener("change",e=>{t.errs.stripe_client=null,t.errs.stripe_server=null,e.error&&(t.errs.stripe_client=e.error.message)}))}}init(){const e=this,t=e.opts,r=e.win,n=e.dom,o=t.formId,i=r.location.href.indexOf("?");if(i>0){const t=e.queryParseString(r.location.href.slice(i+1));for(let e in t)t[e]&&n(`[name="${e}"]`).val(t[e])}const s=t=>{const r=new FormData(t);if(!e.card)return e.doFormSubmit(t,r);const n={};r.forEach((e,t)=>{n[t]=e}),e.model=n;const o={owner:{name:n.first_name+" "+n.last_name,address:{line1:n.address1,line2:n.address2,city:n.city,state:n.state,postal_code:n.postal,country:n.country},email:n.email}};e.stripe.createSource(e.card,o).then(n=>{let o=e.handleStripeResponse(n);if(o){for(let e in o)r.append(e,o[e]);e.doFormSubmit(t,r)}})};let a=n(document.getElementsByClassName("form")[0]);o&&(a=n("#"+o)),a.on("submit",t=>{if(t.preventDefault(),e.isSubmitting)return!1;e.validateAll(e,a),e.validatePhone(e,a),e.validateEmployment(e,a);let n=e.errs,o=e.errs.length<=0;if(o=(o=o&&!n.phone&&!n.amount&&!n.stripe_client&&!n.stripe_server)&&!n.employer&&!n.occupation){e.isSubmitting=!0;const t=a.find('input[name="g-recaptcha-response"]');r.grecaptcha&&t.length>0?r.grecaptcha.ready(function(){r.grecaptcha.execute(t.data("sitekey"),{action:t.data("action")||a.attr("id")}).then(function(e){t.val(e),s(a)})}):s(a)}return!1}),r.Stripe&&e.initStripe(a)}}}.call(this,r(1))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r}])});
//# sourceMappingURL=gcfclient.min.js.map